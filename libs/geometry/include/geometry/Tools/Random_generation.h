#pragma once

#include <vector>
#include <chrono>
#include <random>
#include "geometry/Model/Point_2.h"
#include "geometry/Model/Segment_2.h"


namespace geometry
{
#define clock std::chrono::system_clock
#define time_seed (clock::now().time_since_epoch().count() % 1000000)

	/*!
	 * A Number_generator will generate random numbers using a normal
	 * distribution. A seed can be provided to the constructor, by default it is
	 * determined by the clock
	 */
	template<typename Real>
	class Number_generator
	{
		typedef double dist_number;

	public:
		explicit Number_generator(unsigned long seed = time_seed);

		/**
		 * @return a number following a normal distribution on [inf, sup]
		 */
		Real next_number(const dist_number& inf = -50,
						 const dist_number& sup = 50);

	private:
		std::default_random_engine generator;
		std::normal_distribution<dist_number> distribution;
	};

	/*!
	 * @return a random Point_2 generated by ng
	 */
	template<typename Real>
	Point_2<Real> random_point_2(Number_generator<Real>& ng);
	/*!
	 * @return a random Segment_2 generated by ng
	 */
	template<typename Real>
	Segment_2<Real> random_segment_2(Number_generator<Real>& ng);
	/*!
	 * @return a random Point_2 vector generated by ng
	 */
	template<typename Real>
	std::vector<Point_2<Real>>
	random_point_2_set(unsigned n,
					   Number_generator<Real>& ng);
	/*!
	 * @return a random Segment_2 vector generated by ng
	 */
	template<typename Real>
	std::vector<Segment_2<Real>>
	random_segment_2_set(unsigned n,
						 Number_generator<Real>& ng);


	// +-----------------------------------------------------------------------+
	// |                         TEMPLATE DEFINITIONS                          |
	// +-----------------------------------------------------------------------+

	template<typename Real>
	Number_generator<Real>::Number_generator(unsigned long seed):
			generator(std::default_random_engine(seed)),
			distribution(std::normal_distribution<dist_number>(0, 1))
	{}

	template<typename Real>
	Real Number_generator<Real>::next_number(const dist_number& inf,
											 const dist_number& sup)
	{
		dist_number a = distribution(generator);
		return Real(inf + a * (sup - inf));
	}

	template<typename Real>
	Point_2<Real> random_point_2(Number_generator<Real>& ng)
	{
		Real x = ng.next_number();
		Real y = ng.next_number();
		return Point_2<Real>(x, y);
	}

	template<typename Real>
	Segment_2<Real> random_segment_2(Number_generator<Real>& ng)
	{
		Point_2<Real> p1 = random_point_2(ng);
		Point_2<Real> p2 = random_point_2(ng);
		return Segment_2<Real>(p1, p2);
	}

	template<typename Real>
	std::vector<Point_2<Real>>
	random_point_2_set(unsigned n,
					   Number_generator<Real>& ng)
	{
		std::vector<Point_2<Real>> points;
		for (unsigned i = 0; i < n; ++i)
		{
			points.push_back(random_point_2<Real>(ng));
		}
		return points;
	}

	template<typename Real>
	std::vector<Segment_2<Real>>
	random_segment_2_set(unsigned n,
						 Number_generator<Real>& ng)
	{
		std::vector<Segment_2<Real>> segments;
		for (unsigned i = 0; i < n; ++i)
		{
			segments.push_back(random_segment_2<Real>(ng));
		}
		return segments;
	}
}